<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>substitute.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">OpenNARS Logic Reasoner</a> &gt; <a href="index.source.html" class="el_package">nars.nal.op</a> &gt; <span class="el_source">substitute.java</span></div><h1>substitute.java</h1><pre class="source lang-java linenums">package nars.nal.op;

import nars.Op;
import nars.nal.meta.PremiseAware;
import nars.nal.meta.PremiseMatch;
import nars.term.Term;
import nars.term.TermBuilder;
import nars.term.atom.Atom;
import nars.term.compound.Compound;
import nars.term.transform.MapSubst;
import nars.term.transform.Subst;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.annotations.Nullable;


<span class="fc" id="L16">public class substitute extends ImmediateTermTransform implements PremiseAware {</span>

<span class="fc" id="L18">    public static final Atom INDEP_VAR = Atom.the(&quot;$&quot;, true);</span>
<span class="fc" id="L19">    public static final Atom QUERY_VAR = Atom.the(&quot;?&quot;, true);</span>
<span class="fc" id="L20">    public static final Atom DEP_VAR = Atom.the(&quot;#&quot;, true);</span>

    @NotNull
    @Override
    public Term function(Compound x, TermBuilder i) {
<span class="nc" id="L25">        throw new RuntimeException(&quot;n/a&quot;);</span>
    }

    @Nullable
    @Override
    public Term function(@NotNull Compound p, @NotNull PremiseMatch r) {
<span class="fc" id="L31">        final Term[] xx = p.terms();</span>

        //term to possibly transform
<span class="fc" id="L34">        final Term term = xx[0];</span>

        //original term (x)
<span class="fc" id="L37">        final Term x = xx[1];</span>

        //replacement term (y)
<span class="fc" id="L40">        final Term y = xx[2];</span>

<span class="fc" id="L42">        return subst(r, term, x, y);</span>
    }

    @Nullable
    public static Term resolve(@NotNull PremiseMatch r, Term x) {
<span class="fc" id="L47">        Term x2 = r.yx.get(x);</span>
<span class="fc bfc" id="L48" title="All 2 branches covered.">        if (x2 == null)</span>
<span class="fc" id="L49">            x2 = x;</span>
<span class="fc" id="L50">        return x2;</span>
    }

    @Nullable
    public static Term subst(@NotNull PremiseMatch r, Term term, @NotNull Term x, Term y) {
<span class="pc bpc" id="L55" title="1 of 2 branches missed.">        if (x.equals(y))</span>
<span class="nc" id="L56">            return term;</span>

<span class="fc" id="L58">        x = resolve(r, x);</span>
<span class="fc" id="L59">        y = resolve(r, y);</span>

<span class="fc" id="L61">        MapSubst m = new MapSubst(r.yx);</span>
<span class="fc" id="L62">        m.xy.put(x, y);</span>

<span class="fc" id="L64">        return subst(r, m, term);</span>
    }

    @Nullable
    public static Term subst(@NotNull PremiseMatch r, @NotNull Subst m, Term term) {
<span class="fc" id="L69">        return subst(r.premise.memory().index, m, term);</span>
    }

    @Nullable
    public static Term subst(@NotNull TermBuilder i, @NotNull Subst m, Term term) {
<span class="fc" id="L74">        return i.apply(m, term);</span>
    }

//    protected boolean substitute(Compound p, MapSubst m, Term a, Term b) {
//        final Term type = p.term(1);
//        Op o = getOp(type);
//
//
//        Random rng = new XorShift128PlusRandom(1);
//
//        FindSubst sub = new FindSubst(o, rng) {
//            @Override public boolean onMatch() {
//                return false;
//            }
//        };
//
//        boolean result = sub.match(a, b);
//        m.subs.putAll(sub.xy); //HACK, use the same map instance
//        return result;
//
////        boolean result;
////        if (sub.match(a, b)) { //matchAll?
////            //m.secondary.putAll(sub.xy);
////            result = true;
////        }
////        else {
////            result = false;
////        }
////
////        return result;
//    }


    public static Op getOp(@NotNull Term type) {
        Op o;

        //TODO cache the type
<span class="fc bfc" id="L111" title="All 2 branches covered.">        if (type.equals(INDEP_VAR)) o = Op.VAR_INDEP;</span>
<span class="pc bpc" id="L112" title="1 of 2 branches missed.">        else if (type.equals(DEP_VAR)) o = Op.VAR_DEP;</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">        else if (type.equals(QUERY_VAR)) o = Op.VAR_QUERY;</span>
            //...else
        else
<span class="nc" id="L116">            throw new RuntimeException(&quot;unrecognizd subst type: &quot; + type);</span>
<span class="fc" id="L117">        return o;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.4.201502262128</span></div></body></html>