<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Pointer.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">OpenNARS Logic Reasoner</a> &gt; <a href="index.source.html" class="el_package">nars.op.software.befunge</a> &gt; <span class="el_source">Pointer.java</span></div><h1>Pointer.java</h1><pre class="source lang-java linenums">package nars.op.software.befunge;

import org.jetbrains.annotations.NotNull;

import java.util.HashMap;
import java.util.Map;
import java.util.Random;

/**
 * Created by didrik on 30.12.2014.
 */
public class Pointer {
    private int x, y, dx, dy;
<span class="nc" id="L14">    private final char WIDTH = 80;</span>
<span class="nc" id="L15">    private final char HEIGHT = 25;</span>
    private final Board board;

    //TODO use EnumMap
    @NotNull
    private final Map&lt;Character, Runnable&gt; map;
    @NotNull
    private final BefungeStack stack;

<span class="nc" id="L24">    public Pointer(Board board){</span>
<span class="nc" id="L25">        x = y = 0;</span>
<span class="nc" id="L26">        dx = 1;</span>
<span class="nc" id="L27">        dy = 0;</span>
<span class="nc" id="L28">        stack = new BefungeStack();</span>
<span class="nc" id="L29">        this.board = board;</span>
<span class="nc" id="L30">        map = new HashMap();</span>
<span class="nc" id="L31">        generateMap();</span>
<span class="nc" id="L32">    }</span>

    private void move(){
<span class="nc" id="L35">        x = (x+dx) % WIDTH;</span>
<span class="nc" id="L36">        y = (y+dy) % HEIGHT;</span>
<span class="nc" id="L37">    }</span>

    boolean step(){
<span class="nc" id="L40">        char c = board.get(y, x);</span>
<span class="nc bnc" id="L41" title="All 2 branches missed.">        if (c == '@') return false;</span>
<span class="nc bnc" id="L42" title="All 2 branches missed.">        if (Character.isDigit(c)) stack.push((long) c-'0');</span>
<span class="nc" id="L43">        else map.get(c).run();</span>
<span class="nc" id="L44">        move();</span>
<span class="nc" id="L45">        return true;</span>
    }

    private void generateMap(){
<span class="nc" id="L49">        map.put('+', () -&gt; {</span>
<span class="nc" id="L50">            long temp = stack.pop();</span>
<span class="nc" id="L51">            temp += stack.pop();</span>
<span class="nc" id="L52">            stack.push(temp);</span>
<span class="nc" id="L53">        });</span>

<span class="nc" id="L55">        map.put('-', () -&gt; {</span>
<span class="nc" id="L56">            long temp = -stack.pop();</span>
<span class="nc" id="L57">            temp += stack.pop();</span>
<span class="nc" id="L58">            stack.push(temp);</span>
<span class="nc" id="L59">        });</span>

<span class="nc" id="L61">        map.put('*', () -&gt; {</span>
<span class="nc" id="L62">            long temp = stack.pop();</span>
<span class="nc" id="L63">            temp *= stack.pop();</span>
<span class="nc" id="L64">            stack.push(temp);</span>
<span class="nc" id="L65">        });</span>

<span class="nc" id="L67">        map.put('/', () -&gt; {</span>
<span class="nc" id="L68">            long t1 = stack.pop();</span>
<span class="nc" id="L69">            long t2 = stack.pop();</span>
<span class="nc" id="L70">            stack.push(t2/t1);</span>
<span class="nc" id="L71">        });</span>

<span class="nc" id="L73">        map.put('%', () -&gt; {</span>
<span class="nc" id="L74">            long t1 = stack.pop();</span>
<span class="nc" id="L75">            long t2 = stack.pop();</span>
<span class="nc" id="L76">            stack.push(t2%t1);</span>
<span class="nc" id="L77">        });</span>

<span class="nc bnc" id="L79" title="All 2 branches missed.">        map.put('!', () -&gt; stack.push((long) (stack.pop() == 0 ? 1 : 0)));</span>

<span class="nc bnc" id="L81" title="All 2 branches missed.">        map.put('`', () -&gt; stack.push((long) (stack.pop() &lt;= stack.pop() ? 1 : 0)));</span>

<span class="nc" id="L83">        map.put('&lt;', this::left);</span>

<span class="nc" id="L85">        map.put('&gt;', this::right);</span>

<span class="nc" id="L87">        map.put('v', this::down);</span>

<span class="nc" id="L89">        map.put('^', this::up);</span>

<span class="nc" id="L91">        map.put('?', () -&gt; {</span>
<span class="nc" id="L92">            int[] xarray = {-1, 1, 0, 0};</span>
<span class="nc" id="L93">            int[] yarray = {0, 0, -1, 1};</span>
<span class="nc" id="L94">            Random r = new Random();</span>
<span class="nc" id="L95">            int t = r.nextInt(3);</span>
<span class="nc" id="L96">            dx = xarray[t];</span>
<span class="nc" id="L97">            dy = yarray[t];</span>
<span class="nc" id="L98">        });</span>

<span class="nc" id="L100">        map.put('_', () -&gt; {</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">            if(stack.pop() == 0) right();</span>
<span class="nc" id="L102">            else left();</span>
<span class="nc" id="L103">        });</span>

<span class="nc" id="L105">        map.put('|', () -&gt; {</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">            if(stack.pop() == 0) down();</span>
<span class="nc" id="L107">            else up();</span>
<span class="nc" id="L108">        });</span>

<span class="nc" id="L110">        map.put('&quot;', () -&gt; {</span>
<span class="nc" id="L111">            move();</span>
<span class="nc" id="L112">            char c = board.get(y, x);</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">            while(c != '&quot;'){</span>
<span class="nc" id="L114">                stack.push((long) c);</span>
<span class="nc" id="L115">                move();</span>
<span class="nc" id="L116">                c = board.get(y, x);</span>
            }
<span class="nc" id="L118">        });</span>

<span class="nc" id="L120">        map.put(':', () -&gt; stack.push(stack.peek()));</span>

<span class="nc" id="L122">        map.put('\\', () -&gt; {</span>
<span class="nc" id="L123">            long t1 = stack.pop();</span>
<span class="nc" id="L124">            long t2 = stack.pop();</span>
<span class="nc" id="L125">            stack.push(t2);</span>
<span class="nc" id="L126">            stack.push(t1);</span>
<span class="nc" id="L127">        });</span>

<span class="nc" id="L129">        map.put('$', stack::pop);</span>

<span class="nc" id="L131">        map.put('.', () -&gt; System.out.print(stack.pop()));</span>

<span class="nc" id="L133">        map.put(',', () -&gt; System.out.print((char) stack.pop().shortValue()));</span>

<span class="nc" id="L135">        map.put('#', this::move);</span>

<span class="nc" id="L137">        map.put('p', () -&gt; {</span>
<span class="nc" id="L138">            int y = stack.pop().intValue();</span>
<span class="nc" id="L139">            int x = stack.pop().intValue();</span>
<span class="nc" id="L140">            char v = (char)stack.pop().shortValue();</span>
<span class="nc" id="L141">            board.put(y, x, v);</span>
<span class="nc" id="L142">        });</span>

<span class="nc" id="L144">        map.put('g', () -&gt; {</span>
<span class="nc" id="L145">            int y = stack.pop().intValue();</span>
<span class="nc" id="L146">            int x = stack.pop().intValue();</span>
<span class="nc" id="L147">            char c = board.get(y, x);</span>
<span class="nc" id="L148">            stack.push((long) c);</span>
<span class="nc" id="L149">        });</span>

<span class="nc" id="L151">        map.put(' ', () -&gt; {});</span>
<span class="nc" id="L152">    }</span>

    private void right(){
<span class="nc" id="L155">        dx = 1;</span>
<span class="nc" id="L156">        dy = 0;</span>
<span class="nc" id="L157">    }</span>

    private void left(){
<span class="nc" id="L160">        dx = -1;</span>
<span class="nc" id="L161">        dy = 0;</span>
<span class="nc" id="L162">    }</span>

    private void down(){
<span class="nc" id="L165">        dx = 0;</span>
<span class="nc" id="L166">        dy = 1;</span>
<span class="nc" id="L167">    }</span>

    private void up(){
<span class="nc" id="L170">        dx = 0;</span>
<span class="nc" id="L171">        dy = -1;</span>
<span class="nc" id="L172">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.4.201502262128</span></div></body></html>