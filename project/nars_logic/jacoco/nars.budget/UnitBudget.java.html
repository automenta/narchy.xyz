<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>UnitBudget.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">OpenNARS Logic Reasoner</a> &gt; <a href="index.source.html" class="el_package">nars.budget</a> &gt; <span class="el_source">UnitBudget.java</span></div><h1>UnitBudget.java</h1><pre class="source lang-java linenums">/*
 * BudgetValue.java
 *
 * Copyright (C) 2008  Pei Wang
 *
 * This file is part of Open-NARS.
 *
 * Open-NARS is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 2 of the License, or
 * (at your option) any later version.
 *
 * Open-NARS is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Open-NARS.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
package nars.budget;

import nars.nal.Tense;
import nars.truth.Truth;
import nars.util.data.Util;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.annotations.Nullable;

import static nars.nal.UtilityFunctions.and;
import static nars.nal.UtilityFunctions.or;

/**
 * A triple of priority (current), durability (decay), and quality (long-term average).
 *
 * Mutable, unit-scaled (1.0 max) budget value
 *
 */
public class UnitBudget extends Budget {



    //common instance for a 'deleted budget'.  TODO use a wrapper class to make it unmodifiable
<span class="fc" id="L43">    public static final Budget deleted = new UnitBudget();</span>
<span class="fc" id="L44">    static {  deleted.delete(); }</span>

    //common instance for a 'zero budget'.  TODO use a wrapper class to make it unmodifiable
<span class="fc" id="L47">    public static final Budget zero = new UnitBudget();</span>
<span class="fc" id="L48">    static {  zero.zero();    }</span>

    /**
     * The relative share of time resource to be allocated
     */
    private float priority;

    /**
     * The percent of priority to be kept in a constant period; All priority
     * values &quot;decay&quot; over time, though at different rates. Each item is given a
     * &quot;durability&quot; factor in (0, 1) to specify the percentage of priority level
     * left after each reevaluation
     */
    private float durability;

    /**
     * The overall (context-independent) evaluation
     */
    private float quality;


    /**
     * time at which this budget was last forgotten, for calculating accurate memory decay rates
     */
<span class="fc" id="L72">    protected long lastForgetTime = Tense.TIMELESS;</span>


    public UnitBudget(float p, float d, @Nullable Truth qualityFromTruth) {
<span class="nc bnc" id="L76" title="All 2 branches missed.">        this(p, d, qualityFromTruth !=</span>
<span class="nc" id="L77">                null ? BudgetFunctions.truthToQuality(qualityFromTruth) : 1.0f);</span>
<span class="nc" id="L78">    }</span>


    /**
     * Constructor with initialization
     *
     * @param p Initial priority
     * @param d Initial durability
     * @param q Initial quality
     */
<span class="fc" id="L88">    public UnitBudget(float p, float d, float q) {</span>
<span class="fc" id="L89">        setPriority(p);</span>
<span class="fc" id="L90">        setDurability(d);</span>
<span class="fc" id="L91">        setQuality(q);</span>
<span class="fc" id="L92">    }</span>


    /**
     * begins with 0.0f for all components
     */
<span class="fc" id="L98">    public UnitBudget() {</span>
<span class="fc" id="L99">    }</span>

    public UnitBudget(Budget v) {
<span class="nc" id="L102">        this(v, false);</span>
<span class="nc" id="L103">    }</span>

    /**
     * Cloning constructor
     *
     * @param v Budget value to be cloned
     */
    public UnitBudget(@Nullable Budget v, boolean copyLastForgetTime) {
<span class="nc" id="L111">        this();</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">        if (v != null) {</span>
<span class="nc" id="L113">            budget(v);</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">            if (!copyLastForgetTime)</span>
<span class="nc" id="L115">                setLastForgetTime(-1);</span>
        }
<span class="nc" id="L117">    }</span>





    /**
     * Cloning method
     * TODO give this a less amgiuous name to avoid conflict with subclasses that have clone methods
     */
    @NotNull
    @Override
    public final Budget clone() {
<span class="nc" id="L130">        return new UnitBudget(this, true);</span>
    }




    /**
     * Get priority value
     *
     * @return The current priority
     */
    @Override
    public final float getPriority() {
<span class="fc" id="L143">        return priority;</span>
    }

    /**
     * Change priority value
     *
     * @param p The new priority
     * @return whether the operation had any effect
     */
    @Override
    public final void setPriority(float p) {
<span class="pc bpc" id="L154" title="1 of 2 branches missed.">        if (Budget.getDeleted(p)) {</span>
<span class="nc" id="L155">            throw new RuntimeException(&quot;NaN priority&quot;);</span>
        }
<span class="fc" id="L157">        priority = Util.clamp(p);</span>
<span class="fc" id="L158">    }</span>

    @Override
    public void deleteBudget() {
<span class="fc" id="L162">        this.priority = Float.NaN;</span>
<span class="fc" id="L163">    }</span>

    /**
     * Get durability value
     *
     * @return The current durability
     */
    @Override
    public final float getDurability() {
<span class="fc" id="L172">        return durability;</span>
    }

    /**
     * Change durability value
     *
     * @param d The new durability
     */
    @Override
    public final void setDurability(float d) {
<span class="fc" id="L182">        durability = Util.clamp(d);</span>

<span class="fc" id="L184">    }</span>



    /**
     * Get quality value
     *
     * @return The current quality
     */
    @Override
    public final float getQuality() {
<span class="fc" id="L195">        return quality;</span>
    }

    /**
     * Change quality value
     *
     * @param q The new quality
     */
    @Override
    public final void setQuality(float q) {
<span class="fc" id="L205">        quality = Util.clamp(q);</span>
<span class="fc" id="L206">    }</span>

    /**
     * Increase quality value by a percentage of the remaining range
     *
     * @param v The increasing percent
     */
    public void orQuality(float v) {
<span class="nc" id="L214">        quality = or(quality, v);</span>
<span class="nc" id="L215">    }</span>

    /**
     * Decrease quality value by a percentage of the remaining range
     *
     * @param v The decreasing percent
     */
    public void andQuality(float v) {
<span class="nc" id="L223">        quality = and(quality, v);</span>
<span class="nc" id="L224">    }</span>


    public boolean equals(Object that) {
<span class="nc" id="L228">        throw new RuntimeException(&quot;N/A&quot;);</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L233">        throw new RuntimeException(&quot;N/A&quot;);</span>
     }


    /**
     * Fully display the BudgetValue
     *
     * @return String representation of the value
     */
    @NotNull
    @Override
    public String toString() {
<span class="nc" id="L245">        return getBudgetString();</span>
    }




    @Override
    public final long setLastForgetTime(long currentTime) {

<span class="pc bpc" id="L254" title="1 of 2 branches missed.">        long period = lastForgetTime == Tense.TIMELESS ? 0 : currentTime - lastForgetTime;</span>

<span class="fc" id="L256">        lastForgetTime = currentTime;</span>
<span class="fc" id="L257">        return period;</span>
    }

    @Override
    public long getLastForgetTime() {
<span class="fc" id="L262">        return lastForgetTime;</span>
    }





    @Override
    public void mulPriority(float factor) {
<span class="fc" id="L271">        setPriority(priority * factor);</span>
<span class="fc" id="L272">    }</span>

    public void mulDurability(float factor) {
<span class="fc" id="L275">        setDurability(durability * factor);</span>
<span class="fc" id="L276">    }</span>



}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.4.201502262128</span></div></body></html>