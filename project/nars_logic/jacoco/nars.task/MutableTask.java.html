<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>MutableTask.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">OpenNARS Logic Reasoner</a> &gt; <a href="index.source.html" class="el_package">nars.task</a> &gt; <span class="el_source">MutableTask.java</span></div><h1>MutableTask.java</h1><pre class="source lang-java linenums">package nars.task;

import nars.Memory;
import nars.Symbols;
import nars.budget.Budget;
import nars.budget.BudgetFunctions;
import nars.concept.ConceptProcess;
import nars.nal.Tense;
import nars.term.Termed;
import nars.term.compound.Compound;
import nars.truth.DefaultTruth;
import nars.truth.Truth;
import org.jetbrains.annotations.NotNull;

import javax.annotation.Nullable;
import java.lang.ref.Reference;

import static nars.Global.dereference;
import static nars.Global.reference;

/**
 * Mutable task with additional fluent api utility methods
 */
public class MutableTask extends AbstractTask {

    public MutableTask() {
        /** budget triple - to be valid, at least the first 2 of these must be non-NaN (unless it is a question)  */
<span class="fc" id="L28">        super(null, (char) 0, null,</span>
            /* budget: */ 0, Float.NaN, Float.NaN);

<span class="fc" id="L31">        setEternal();</span>
<span class="fc" id="L32">        setOccurrenceTime(Tense.TIMELESS);</span>
<span class="fc" id="L33">    }</span>

    @NotNull
    public static MutableTask clone(@NotNull Task t) {
<span class="nc" id="L37">        return new MutableTask(t, true);</span>
    }

    MutableTask(@NotNull Task taskToClone, boolean dummy) {
<span class="nc" id="L41">        super(taskToClone);</span>
<span class="nc" id="L42">    }</span>

    public MutableTask(Termed&lt;Compound&gt; term) {
<span class="fc" id="L45">        this();</span>
<span class="fc" id="L46">        term(term);</span>
<span class="fc" id="L47">    }</span>

    public MutableTask(Termed&lt;Compound&gt; content, char punc) {
<span class="fc" id="L50">        this(content);</span>
<span class="fc" id="L51">        punctuation(punc);</span>
<span class="fc" id="L52">    }</span>


    @NotNull
    public MutableTask truth(@org.jetbrains.annotations.Nullable Truth tv) {
<span class="fc bfc" id="L57" title="All 2 branches covered.">        if (tv == null)</span>
<span class="fc" id="L58">            setTruth(null);</span>
        else
<span class="fc" id="L60">            setTruth(new DefaultTruth(tv));</span>
<span class="fc" id="L61">        return this;</span>
    }



    @NotNull
    @Override
    public final MutableTask budget(float p, float d, float q) {
<span class="fc" id="L69">        super.budget(p, d, q);</span>
<span class="fc" id="L70">        return this;</span>
    }

    @NotNull
    @Override
    public final MutableTask budget(@Nullable Budget source) {
<span class="fc" id="L76">        super.budget(source);</span>
<span class="fc" id="L77">        return this;</span>
    }

    /**
     * uses default budget generation and multiplies it by gain factors
     */
    @NotNull
    public MutableTask budgetScaled(float priorityFactor, float durFactor) {
<span class="fc" id="L85">        mulPriority(priorityFactor);</span>
<span class="fc" id="L86">        mulDurability(durFactor);</span>
<span class="fc" id="L87">        return this;</span>
    }

    @NotNull
    public final MutableTask term(Termed&lt;Compound&gt; t) {
<span class="fc" id="L92">        setTerm(t);</span>
<span class="fc" id="L93">        return this;</span>
    }

    @NotNull
    public final MutableTask truth(float freq, float conf) {
        //if (truth == null)
<span class="fc" id="L99">            setTruth(new DefaultTruth(freq, conf));</span>
        //else
            //this.truth.set(freq, conf);
<span class="fc" id="L102">        return this;</span>
    }


    @NotNull
    public MutableTask belief() {
<span class="fc" id="L108">        return judgment();</span>
    }

    @NotNull
    public MutableTask judgment() {
<span class="fc" id="L113">        setPunctuation(Symbols.JUDGMENT);</span>
<span class="fc" id="L114">        return this;</span>
    }

    @NotNull
    public MutableTask question() {
<span class="fc" id="L119">        setPunctuation(Symbols.QUESTION);</span>
<span class="fc" id="L120">        return this;</span>
    }

    @NotNull
    public MutableTask quest() {
<span class="nc" id="L125">        setPunctuation(Symbols.QUEST);</span>
<span class="nc" id="L126">        return this;</span>
    }

    @NotNull
    public MutableTask goal() {
<span class="fc" id="L131">        setPunctuation(Symbols.GOAL);</span>
<span class="fc" id="L132">        return this;</span>
    }

    @NotNull
    public MutableTask tense(@NotNull Tense t, @NotNull Memory memory) {
<span class="fc" id="L137">        occurr(Tense.getOccurrenceTime(memory.time(), t, memory));</span>
<span class="fc" id="L138">        return this;</span>
    }

    @NotNull
    public final MutableTask present(@NotNull Memory memory) {
        //return tense(Tense.Present, memory);
<span class="fc" id="L144">        long now = memory.time();</span>
<span class="fc" id="L145">        return time(now, now);</span>
    }

    @NotNull
    public MutableTask budget(float p, float d) {
        float q;
<span class="fc" id="L151">        Truth t = getTruth();</span>
<span class="pc bpc" id="L152" title="1 of 2 branches missed.">        if (!isQuestOrQuestion()) {</span>
<span class="pc bpc" id="L153" title="1 of 2 branches missed.">            if (t == null)</span>
<span class="nc" id="L154">                throw new RuntimeException(&quot;Truth needs to be defined prior to budget to calculate truthToQuality&quot;);</span>
<span class="fc" id="L155">            q = BudgetFunctions.truthToQuality(t);</span>
        } else
<span class="nc" id="L157">            throw new RuntimeException(&quot;incorrect punctuation&quot;);</span>

<span class="fc" id="L159">        budget(p, d, q);</span>
<span class="fc" id="L160">        return this;</span>
    }

    @NotNull
    public MutableTask punctuation(char punctuation) {
<span class="fc" id="L165">        setPunctuation(punctuation);</span>
<span class="fc" id="L166">        return this;</span>
    }

    @NotNull
    public MutableTask time(long creationTime, long occurrenceTime) {
<span class="fc" id="L171">        setCreationTime(creationTime);</span>
<span class="fc" id="L172">        occurr(occurrenceTime);</span>
<span class="fc" id="L173">        return this;</span>
    }


    @NotNull
    public MutableTask because(Object reason) {
<span class="fc" id="L179">        log(reason);</span>
<span class="fc" id="L180">        return this;</span>
    }


    public final MutableTask parent(@org.jetbrains.annotations.Nullable Task parentTask, Task parentBelief) {
<span class="pc bpc" id="L185" title="1 of 2 branches missed.">        if (parentTask == null)</span>
<span class="nc" id="L186">            throw new RuntimeException(&quot;parent task being set to null&quot;);</span>



        //TODO avoid creating the ref's if not necessary?
<span class="fc" id="L191">        return parent(reference(parentTask), reference(parentBelief));</span>
    }

    @NotNull
    public MutableTask parent(Reference&lt;Task&gt; rt, Reference&lt;Task&gt; rb) {

<span class="fc" id="L197">        Task pt = dereference(rt);</span>
<span class="fc" id="L198">        Task pb = dereference(rb);</span>

<span class="fc bfc" id="L200" title="All 4 branches covered.">        if (pt!=null &amp;&amp; pt.isCommand()) rt = null;</span>
<span class="pc bpc" id="L201" title="1 of 4 branches missed.">        if (pb!=null &amp;&amp; pb.isCommand()) rb = null;</span>

<span class="fc" id="L203">        this.parentTask = rt;</span>
<span class="fc" id="L204">        this.parentBelief = rb;</span>
<span class="fc" id="L205">        updateEvidence();</span>

<span class="fc" id="L207">        return this;</span>
    }


    @NotNull
    public final MutableTask occurr(long occurrenceTime) {
<span class="fc" id="L213">        setOccurrenceTime(occurrenceTime);</span>
<span class="fc" id="L214">        return this;</span>
    }

    public final MutableTask parent(Task task) {
<span class="fc" id="L218">        return parent(task, null);</span>
    }

    /**
     //     * sets an amount of cycles to shift the final applied occurence time
     //     */
//    public TaskSeed&lt;T&gt; occurrDelta(long occurenceTime) {
//        this.occDelta = occurenceTime;
//        return this;
//    }

    @NotNull
    public MutableTask eternal() {
<span class="fc" id="L231">        setEternal();</span>
<span class="fc" id="L232">        return this;</span>
    }


    /** flag used for anticipatable derivation */
    @NotNull
    public MutableTask anticipate(boolean a) {
<span class="pc bpc" id="L239" title="1 of 2 branches missed.">        if (state==TaskState.Executed)</span>
<span class="nc" id="L240">            throw new RuntimeException(&quot;can not anticipate already executed task&quot;);</span>

<span class="fc bfc" id="L242" title="All 2 branches covered.">        if (a) state = (TaskState.Anticipated);</span>
<span class="fc" id="L243">        return this;</span>
    }

    @NotNull
    public MutableTask budgetCompoundForward(@NotNull ConceptProcess premise) {
<span class="fc" id="L248">        BudgetFunctions.compoundForward(</span>
<span class="fc" id="L249">                getBudget(), getTruth(),</span>
<span class="fc" id="L250">                term(), premise);</span>
<span class="fc" id="L251">        return this;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.4.201502262128</span></div></body></html>