<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Param.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">OpenNARS Logic Reasoner</a> &gt; <a href="index.source.html" class="el_package">nars</a> &gt; <span class="el_source">Param.java</span></div><h1>Param.java</h1><pre class="source lang-java linenums">package nars;

import nars.budget.BudgetFunctions;
import nars.data.Range;
import nars.nal.Level;
import nars.task.MutableTask;
import nars.truth.DefaultTruth;
import nars.truth.Truth;
import nars.util.data.MutableInteger;
import objenome.Container;
import org.apache.commons.lang3.mutable.MutableFloat;
import org.jetbrains.annotations.NotNull;

import java.util.concurrent.atomic.AtomicInteger;

import static nars.Symbols.GOAL;
import static nars.Symbols.JUDGMENT;

/**
 * NAR Parameters which can be changed during runtime.
 */
<span class="fc" id="L22">public abstract class Param extends Container implements Level {</span>


<span class="fc" id="L25">    public final MutableInteger cyclesPerFrame = new MutableInteger(1);</span>

    /**
     * Perfection determines a minimum budget prioritization of items
     * in proportion to the budgeted quality. This means that the
     * attention of a reasoner in higher perfection state
     * will be more dominated by high-quality items.  In other words,
     * it is driven more towards maximization of quality rather than
     * allowing for exploration of that which has less quality.
     *
     * previously called &quot;bag threshold&quot; and had default value = 0.1
     */
<span class="fc" id="L37">    @NotNull</span>
    @Range(min=0, max=1f)
<span class="fc" id="L39">    public MutableFloat perfection = new MutableFloat(0.1);</span>


    //    /** Silent threshold for task reporting, in [0, 100].
//     *  Noise level = 100 - silence level; noise 0 = always silent, noise 100 = never silent
//     */
//    public final AtomicInteger outputVolume = new AtomicInteger();

    /** 
       Cycles per duration.
       Past/future tense usage convention;
       How far away &quot;past&quot; and &quot;future&quot; is from &quot;now&quot;, in cycles.         
       The range of &quot;now&quot; is [-DURATION/2, +DURATION/2];      */
<span class="fc" id="L52">    public final MutableInteger duration = new MutableInteger();</span>

<span class="fc" id="L54">    public final MutableInteger shortTermMemoryHistory = new MutableInteger();</span>



//    /** converts durations to cycles */
//    public final float durationToCycles(MutableFloat durations) {
//        return durationToCycles(durations.floatValue());
//    }
//
//    public final float durationToCycles(float durations) {
//        return duration.floatValue() * durations;
//    }







//    /** Concept decay rate in ConceptBag, in [1, 99].  originally: CONCEPT_FORGETTING_CYCLE
//     *  How many cycles it takes an item to decay completely to a threshold value (ex: 0.1).
//     *  Lower means faster rate of decay.
//     */
//    @Deprecated public final MutableFloat conceptForgetDurations = new MutableFloat();
    
    /** TermLink decay rate in TermLinkBag, in [1, 99]. originally: TERM_LINK_FORGETTING_CYCLE */
    //TODO use separate termlink forget rates whether the termlink was actually selected for firing or not.
    //@Deprecated public final MutableFloat termLinkForgetDurations = new MutableFloat();
    
    /** TaskLink decay rate in TaskLinkBag, in [1, 99]. originally: TASK_LINK_FORGETTING_CYCLE */
<span class="fc" id="L84">    public final MutableFloat linkForgetDurations = new MutableFloat();</span>

<span class="fc" id="L86">    public final MutableFloat conceptForgetDurations = new MutableFloat();</span>
    

     /*
     BUDGET THRESHOLDS
     * Increasing this value decreases the resolution with which
     *   budgets are propagated or otherwise measured, which can result
     *   in a performance gain.      */


//    /** budget summary necessary to Conceptualize. this will compare the summary of the task during the TaskProcess */
//    public final AtomicDouble newConceptThreshold = new AtomicDouble(0);

    /** budget durability threshold  necessary to form a derived task. */
<span class="fc" id="L100">    public final MutableFloat derivationDurabilityThreshold = new MutableFloat(0);</span>


//    /** budget summary necessary to execute a desired Goal */
//    public final AtomicDouble questionFromGoalThreshold = new AtomicDouble(0);

    /** budget summary necessary to run a TaskProcess for a given Task
     *  this should be equal to zero to allow subconcept seeding. */
<span class="fc" id="L108">    public final MutableFloat taskProcessThreshold = new MutableFloat(0);</span>

    /** budget summary necessary to propagte tasklink activation */
<span class="fc" id="L111">    public final MutableFloat taskLinkThreshold = new MutableFloat(0);</span>

    /** budget summary necessary to propagte termlink activation */
<span class="fc" id="L114">    public final MutableFloat termLinkThreshold = new MutableFloat(0);</span>

    /** Minimum expectation for a desire value.
     *  the range of &quot;now&quot; is [-DURATION, DURATION]; */
<span class="fc" id="L118">    public final MutableFloat executionExpectationThreshold = new MutableFloat();</span>




    /** Maximum number of beliefs kept in a Concept */
<span class="fc" id="L124">    public final AtomicInteger conceptBeliefsMax = new AtomicInteger();</span>
    
    /** Maximum number of questions, and max # of quests kept in a Concept */
<span class="fc" id="L127">    public final AtomicInteger conceptQuestionsMax = new AtomicInteger();</span>

    /** Maximum number of goals kept in a Concept */
<span class="fc" id="L130">    public final AtomicInteger conceptGoalsMax = new AtomicInteger();</span>

    public float getDefaultConfidence(char punctuation) {

<span class="pc bpc" id="L134" title="1 of 3 branches missed.">        switch (punctuation) {</span>
            case JUDGMENT:
<span class="fc" id="L136">                return DEFAULT_JUDGMENT_CONFIDENCE;</span>

            case GOAL:
<span class="fc" id="L139">                return DEFAULT_GOAL_CONFIDENCE;</span>

            default:
<span class="nc" id="L142">                throw new RuntimeException(&quot;Invalid punctuation &quot; + punctuation + &quot; for a TruthValue&quot;);</span>
        }
    }

    public void applyDefaultBudget(@NotNull MutableTask t) {

<span class="fc" id="L148">        char punc = t.getPunctuation();</span>
<span class="fc" id="L149">        t.setPriority(getDefaultPriority(punc));</span>
<span class="fc" id="L150">        t.setDurability(getDefaultDurability(punc));</span>

<span class="fc bfc" id="L152" title="All 2 branches covered.">        if (t.isJudgmentOrGoal()) {</span>

            /** if q was not specified, and truth is, then we can calculate q from truthToQuality */
<span class="pc bpc" id="L155" title="1 of 2 branches missed.">            if (!Float.isFinite(t.getQuality())) {</span>
<span class="fc" id="L156">                t.setQuality(BudgetFunctions.truthToQuality(t.getTruth()));</span>
            }
<span class="fc bfc" id="L158" title="All 2 branches covered.">        } else if (t.isQuestion()) {</span>
<span class="fc" id="L159">            t.setQuality(DEFAULT_QUESTION_QUALITY);</span>
<span class="pc bpc" id="L160" title="1 of 2 branches missed.">        } else if (t.isQuest()) {</span>
<span class="fc" id="L161">            t.setQuality(DEFAULT_QUEST_QUALITY);</span>
        }

<span class="fc" id="L164">    }</span>

    /** Default confidence of input judgment. */
<span class="fc" id="L167">    float DEFAULT_JUDGMENT_CONFIDENCE = 0.9f;</span>

    /** Default priority of input judgment */
<span class="fc" id="L170">    float DEFAULT_JUDGMENT_PRIORITY = 0.5f;</span>
    /** Default durability of input judgment */
<span class="fc" id="L172">    float DEFAULT_JUDGMENT_DURABILITY = 0.5f; //was 0.8 in 1.5.5; 0.5 after</span>
    /** Default priority of input question */
<span class="fc" id="L174">    float DEFAULT_QUESTION_PRIORITY = 0.5f;</span>
    /** Default durability of input question */
<span class="fc" id="L176">    float DEFAULT_QUESTION_DURABILITY = 0.5f;</span>


    /** Default confidence of input goal. */
<span class="fc" id="L180">    float DEFAULT_GOAL_CONFIDENCE = 0.9f;</span>
    /** Default priority of input judgment */
<span class="fc" id="L182">    float DEFAULT_GOAL_PRIORITY = 0.5f;</span>
    /** Default durability of input judgment */
<span class="fc" id="L184">    float DEFAULT_GOAL_DURABILITY = 0.5f;</span>
    /** Default priority of input question */
<span class="fc" id="L186">    float DEFAULT_QUEST_PRIORITY = 0.5f;</span>
    /** Default durability of input question */
<span class="fc" id="L188">    float DEFAULT_QUEST_DURABILITY = 0.5f;</span>

<span class="fc" id="L190">    float DEFAULT_QUESTION_QUALITY = 0.5f;</span>
<span class="fc" id="L191">    float DEFAULT_QUEST_QUALITY = 0.5f;</span>

    float getDefaultPriority(char punctuation) {
<span class="pc bpc" id="L194" title="1 of 5 branches missed.">        switch (punctuation) {</span>
            case Symbols.JUDGMENT:
<span class="fc" id="L196">                return DEFAULT_JUDGMENT_PRIORITY;</span>

            case Symbols.QUEST:
<span class="fc" id="L199">                return DEFAULT_QUEST_PRIORITY;</span>

            case Symbols.QUESTION:
<span class="fc" id="L202">                return DEFAULT_QUESTION_PRIORITY;</span>

            case Symbols.GOAL:
<span class="fc" id="L205">                return DEFAULT_GOAL_PRIORITY;</span>
        }
<span class="nc" id="L207">        throw new RuntimeException(&quot;Unknown sentence type: &quot; + punctuation);</span>
    }

    float getDefaultDurability(char punctuation) {
<span class="pc bpc" id="L211" title="1 of 5 branches missed.">        switch (punctuation) {</span>
            case Symbols.JUDGMENT:
<span class="fc" id="L213">                return DEFAULT_JUDGMENT_DURABILITY;</span>
            case Symbols.QUEST:
<span class="fc" id="L215">                return DEFAULT_QUEST_DURABILITY;</span>
            case Symbols.QUESTION:
<span class="fc" id="L217">                return DEFAULT_QUESTION_DURABILITY;</span>
            case Symbols.GOAL:
<span class="fc" id="L219">                return DEFAULT_GOAL_DURABILITY;</span>
        }
<span class="nc" id="L221">        throw new RuntimeException(&quot;Unknown sentence type: &quot; + punctuation);</span>
    }
    float getDefaultQuality(char punctuation) {
<span class="nc bnc" id="L224" title="All 3 branches missed.">        switch (punctuation) {</span>
            case Symbols.QUESTION:
<span class="nc" id="L226">                return DEFAULT_QUESTION_DURABILITY;</span>
            case Symbols.GOAL:
<span class="nc" id="L228">                return DEFAULT_GOAL_DURABILITY;</span>
        }
<span class="nc" id="L230">        throw new RuntimeException(&quot;Use truthToQuality for: &quot; + punctuation);</span>
    }

    //decision threshold is enough for now
<span class="fc" id="L234">    float EXECUTION_SATISFACTION_TRESHOLD = 0;</span>

    public float getExecutionSatisfactionThreshold() {
<span class="nc" id="L237">        return EXECUTION_SATISFACTION_TRESHOLD;</span>
    }

    public final Truth newDefaultTruth(char p) {
<span class="fc bfc" id="L241" title="All 2 branches covered.">        switch (p) {</span>
            case GOAL:
<span class="fc" id="L243">            case JUDGMENT: return new DefaultTruth(1.0f, getDefaultConfidence(p));</span>
            default:
<span class="fc" id="L245">                return null;</span>
        }
    }


//    /** Reliance factor, the empirical confidence of analytical truth.
//        (generally, the same as default judgment confidence)  */
//    public final AtomicDouble reliance = new AtomicDouble();




/*    public static Param fromJSON(String json) {
        return Param.json.fromJson(json, Param.class);
    }*/
//    @Override
//    public String toString() {
//        return Json.toJson(this);
//    }
    
//    public double[] toGenome(String... excludeFields) {
//        JsonObject j = json.toJsonTree(this).getAsJsonObject();
//        TreeSet&lt;Map.Entry&lt;String, JsonElement&gt;&gt; fields = new TreeSet&lt;&gt;(j.entrySet());
//        
//        Set&lt;String&gt; excluded = new HashSet();
//        for (String e : excludeFields)
//            excluded.add(e);
//        
//        List&lt;Double&gt; l = new ArrayList();
//        for (Map.Entry&lt;String, JsonElement&gt; e : fields) {
//            String f = e.getKey();
//            if (excluded.contains(f))
//                continue;
//            JsonElement v = e.getValue();
//            if (v.isJsonPrimitive()) {
//                try {
//                    double d = v.getAsDouble();
//                    l.add(d);                
//                }
//                catch (NumberFormatException nfe) { }
//            }
//        }
//        return Doubles.toArray(l);
//    }
    
//    static public final Gson json;
//    static {
//        GsonBuilder b = new GsonBuilder();
//        b.setPrettyPrinting();
//        b.disableHtmlEscaping();
//        b.serializeNulls();
//
//        final JsonSerializer&lt;AtomicDouble&gt; atomicDoubleSerializer = new JsonSerializer&lt;AtomicDouble&gt;() {
//            @Override public JsonElement serialize(AtomicDouble t, Type type, JsonSerializationContext jsc) {
//                return new JsonPrimitive(t.get());
//            }
//        };
//
//        JsonDeserializer&lt;AtomicDouble&gt; atomicDoubleDeserializer = new JsonDeserializer&lt;AtomicDouble&gt;() {
//            @Override public AtomicDouble deserialize(JsonElement je, Type type, JsonDeserializationContext jdc) throws JsonParseException {
//                return new AtomicDouble(je.getAsDouble());
//            }
//        };
//
//        b.registerTypeAdapter(AtomicDouble.class, atomicDoubleSerializer);
//        b.registerTypeAdapter(AtomicDouble.class, atomicDoubleDeserializer);
//
//        b.registerTypeAdapter(AtomicInteger.class, new JsonSerializer&lt;AtomicInteger&gt;() {
//            @Override public JsonElement serialize(AtomicInteger t, Type type, JsonSerializationContext jsc) {
//                return new JsonPrimitive(t.get());
//            }
//        });
//        b.registerTypeAdapter(AtomicInteger.class, new JsonDeserializer&lt;AtomicInteger&gt;() {
//            @Override public AtomicInteger deserialize(JsonElement je, Type type, JsonDeserializationContext jdc) throws JsonParseException {
//                return new AtomicInteger(je.getAsInt());
//            }
//        });
//
//
//        json = b.create();
//    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.4.201502262128</span></div></body></html>